# The Chubby lock service for loosely-coupled distributed systems

## 摘要

我们描述了Chubby Lock服务的经验，该服务旨在为松耦合的分布式系统提供粗粒度锁以及可靠（尽管容量较小）存储。 Chubby提供的界面很像带有咨询锁的分布式文件系统，但是设计重点是可用性和可靠性，而不是高性能。 该服务的许多实例已使用了一年多，其中几个实例同时处理数万个客户端。 本文介绍了初始设计和预期用途，并将其与实际用途进行了比较，并说明了如何修改设计以适应差异。

## 1. Introduction

本文介绍了一种称为Chubby的锁定服务。 它旨在用于由高速网络连接的中等数量的小型机器组成的松耦合分布式系统中。 例如，一个Chubby实例（也称为Chubby单元）可以服务于通过1Gbit/s以太网连接的1万台4处理器机器。 尽管我们确实运行至少一个Chubby单元，其副本之间相距数千公里，但大多数Chubby单元都局限于一个数据中心或机房中。

锁服务的目的是允许其客户端同步其活动并就有关其环境的基本信息达成一致。 主要目标包括可靠性，对大量客户端的可用性以及易于理解的语义。 吞吐量和存储容量被认为是次要的。 Chubby的客户端界面类似于一个简单的文件系统，该界面执行整个文件的读取和写入操作，并具有咨询锁和各种事件通知（例如文件修改）的增强。

我们希望Chubby能够帮助开发人员处理其系统内的粗粒度同步，尤其是要解决从一组其他等效服务器中选拔领导者的问题。 例如，Google文件系统使用Chubby锁来指定GFS master，而Bigtable使用Chubby有以下几种方式：选举一个master，允许该master发现它控制的服务器，以及允许客户端找到master。 此外，GFS和Bigtable都将Chubby用作众所周知的可用位置来存储少量的元数据。 实际上，他们将Chubby用作其分布式数据结构的根。 一些服务使用锁在多个服务器之间对工作进行分区（粗略地划分）。

在部署Chubby之前，Google的大多数分布式系统都采用临时方法进行领导选举(primary selection)（当可以无伤害地复制工作时），或者需要操作员干预（当必不可少时）。 在前一种情况下，Chubby节省了一些计算工作量。 在后一种情况下，它在不再需要人工干预故障的系统中实现了可用性的显着提高。

熟悉分布式计算的读者将认识到领导选举是分布式共识问题的一个实例，并意识到我们需要使用异步通信的解决方案。 该术语描述了绝大多数实际网络（例如以太网或Internet）的行为，这些网络允许数据包丢失，延迟和重新排序。 （从业者通常应提防基于对环境做出更强假设的模型的协议。）异步共识由Paxos协议解决。 Oki和Liskov使用了相同的协议，其他人则指出了等效的概念。 确实，到目前为止，我们遇到的所有用于异步共识的工作协议都以Paxos为核心。 Paxos无需时序假设即可保持安全性，但必须引入时钟以确保活力。 这克服了Fischer等人的不可能结果。

建立Chubby是满足上述需求的一项工程工作，而不是研究。 我们没有应用新的算法或技术。 本文的目的是描述我们所做的事情和原因，而不是提倡它。 在以下各节中，我们将描述Chubby的设计和实现，以及它根据经验而发生的变化。 我们描述了Chubby的意外使用方式，以及被证明是错误的功能。 我们忽略了文献其他地方涵盖的细节，例如共识协议或RPC系统的细节。
