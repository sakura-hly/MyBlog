# Redis 的缓存穿透、缓存雪崩、缓存击穿
## 缓存穿透
> 缓存穿透，是指查询一个数据库一定不存在的数据。

由于缓存不命中时需要从数据库查询，查不到数据则不写入缓存，这就导致这个不存在的数据每次从数据库去查询，造成缓存穿透。

比如，数据库的id都是从1开始，结果黑客发过来的请求 id 全部都是负数。这样的话，缓存中不会有，请求每次都“视缓存于无物”，直接查询数据库。

解决办法：
1. 布隆过滤器。将所有可能存在的数据哈希到一个足够大的bitmap中，一个一定不存在的数据会被这个bitmap拦截掉，从而避免了对底层存储系统的查询压力。
关于布隆过滤器，可以参考我这篇[布隆过滤器](./../算法相关/布隆过滤器.md)
2. 缓存空对象。还有一个方法，如果一个查询返回的数据为空，我们仍然把这个空结果进行缓存，并设置一个过期时间。

## 缓存雪崩
如果缓存集中在一段时间内失效（或者缓存机器意外宕机），发生大量的缓存穿透，所有的查询都落在数据库上，造成了缓存雪崩。

缓存雪崩的解决方案如下：
1. 保证缓存层的高可用，如 Redis 持久化、主从架构 + 哨兵模式，或者 Redis cluster
2. 分析用户行为，尽量让失效时间点均匀分布，避免缓存雪崩的出现
3. 使用 hystrix 做限流和降级

## 缓存击穿
缓存击穿，就是说某个热点key，访问非常频繁，当这个key失效瞬间，大量的请求就击穿了缓存，直接落到数据库。

解决方式很简单：
1. 可以将热点key设置为永久
2. 使用互斥锁，在获取该key发现为空，先锁住，再从数据库加载，加载完毕，释放锁。 